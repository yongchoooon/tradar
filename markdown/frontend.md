# Frontend 구조 개요

## 엔드포인트 요약
- 멀티모달 검색: `POST /search/multimodal`
- 상품/서비스류 추천: `GET /goods/search`
- 이미지 프록시: `GET /media?path=...`

## 루트 컴포넌트
- 파일: `app/frontend/app.jsx`
- 전역 상태: `selectedGroups`, `response`, `loading`, `error`
- 검색 요청 시 `k=20`으로 고정해 Top-K를 요청합니다.

## 주요 컴포넌트

### TrademarkSearchForm
- 상표명 텍스트와 이미지 업로드 입력 제공
- 선택된 유사군/류 요약을 보여 주지만 검색 점수에는 사용하지 않습니다.
- 제출 시 이미지 파일을 Base64 로 읽어 `/search/multimodal`에 전송

### GoodsSearchPanel
- 키워드로 유사군을 찾는 보조 UI
- 체크된 유사군은 `selectedGroups`에 저장되어 검색 요청에 포함됩니다 (향후 인접/비인접 그룹 표시를 위해 예약되어 있으며 현재 순위에는 영향을 주지 않음)

### ResultSection / ResultCard
- `response.image_top`, `response.text_top`을 Top-20 카드 그리드로 렌더링하고, 상태가 `등록`/`공고`가 아닌 후보는 `image_misc`, `text_misc` 섹션에 노출
- 카드에는 출원번호, 상태 배지, 분류, DOI 링크(있는 경우), 이미지/텍스트 점수를 보여 주며 썸네일이 상단에 표시됩니다.
- 각 결과 섹션 아래에는 프롬프트 입력창과 `이미지 재검색`, `텍스트 재검색` 버튼(디버그 모드 포함)이 노출됩니다. 입력 영역에서 Enter 키(Shift+Enter 제외)를 누르면 기본 재검색이 즉시 실행되며, "최우선"/"우선"/"균형"/"프롬프트 우선"(90/10 · 70/30 · 50/50 · 30/70 · 10/90) 프리셋 중 하나를 선택해 기존 검색과 프롬프트 임베딩의 비중을 조절할 수 있습니다.
- 디버그 모드를 활성화하면 재검색 가중치·LLM 해석 결과·폴백 여부가 "추가 메시지" 블록으로 함께 표시됩니다.
- 재검색 후에는 `원래 이미지 결과`, `원래 텍스트 결과` 버튼으로 초기 응답으로 되돌릴 수 있으며, 내부 캐시를 사용해 추가 API 호출 없이 즉시 복원합니다.

### SimulationPanel
- 검색 결과가 있으면 우측 패널이 나타나 기본 선택(이미지 5건 + 텍스트 5건)을 요약합니다.
- `시뮬레이션 실행`을 누르면 즉시 상태가 `queued`로 전환되고 SSE(`/simulation/stream/{job_id}`)로 진행 상황을 수신합니다.
- 실행이 시작된 순간부터 경과 시간이 `경과 시간 0분 05초` 방식으로 패널에 표시되며, 작업이 완료된 뒤에도 최종 소요 시간을 유지합니다.
- 패널 헤더에 현재 사용 중인 LLM 모델명(`SIMULATION_LLM_MODEL`)이 함께 표시됩니다.
- 패널 상단에서는 최종 리포터 LLM이 생성한 고정 Markdown 요약(전체 결론/평균 점수/후속 권고/선행상표별 한 줄 요약)을 보여 줍니다.
- 각 후보별 카드는 접기/펼치기 형태로 제공되며, 펼쳤을 때 최종 점수와 함께 휴리스틱(유사도 기반) 점수, LLM(채점자 에이전트) 점수, 리포터 Markdown, LLM 근거를 확인할 수 있습니다.
- 시뮬레이션이 진행 중이면 `실행 취소` 버튼이 활성화되어 백엔드 작업을 중단할 수 있으며, 상태는 SSE 스트림으로 즉시 갱신됩니다.
- `시뮬레이션 실행(디버그)` 버튼을 누르면 각 후보에 대한 KIPRIS 컨텍스트와 LLM 프롬프트/응답 로그가 `logs/simulation_debug/<timestamp>` 하위에 생성됩니다.
- 완료되면 평균 점수, 상위 3건 요약, 세부 대화(`transcript`)를 펼쳐 볼 수 있습니다.

## 상태 흐름

1. 사용자가 유사군을 선택하면 `selectedGroups`가 갱신됩니다.
2. 상표명/이미지를 입력 후 검색하면 `loading` 상태로 전환 → 응답을 `response`에 저장
3. `ResultSection`은 이미지/텍스트 Top-20과 "기타"(등록/공고 외) 섹션을 렌더링합니다.
4. 오류 발생 시 `error` 메시지를 상단에 노출합니다.

## 스타일 가이드
- 기본 스타일은 Pico.css, 세부 커스터마이징은 `app/frontend/styles.css`
- 검색 폼, 드롭존, 결과 카드 모두 동일한 박스 그림자를 사용해 레이아웃 일관성 유지
- 반응형: 768px 이하에서는 결과 카드를 한 줄에 하나만 표시하도록 그리드 조정

## 변경 시 체크리스트
- `SearchResult` 필드가 바뀌면 이 문서와 `ResultCard` 렌더링 코드를 함께 수정합니다.
- 새로운 필터/옵션을 추가할 경우 `selectedGroups` 구조와 API 계약을 문서화합니다.
- 이미지 업로드 방식이나 미리보기 로직을 변경하면 메모리 관리(Blob URL 해제 등)도 검토하세요.
